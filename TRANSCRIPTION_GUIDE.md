# èªéŸ³è½‰éŒ„é é¢ä½¿ç”¨æŒ‡å—

## âœ… å·²å®Œæˆçš„é‡æ§‹

### å¾ Realtime API æ”¹ç‚º Whisper API

**åŸæ–¹æ¡ˆï¼ˆå·²ç§»é™¤ï¼‰ï¼š**
- âŒ ä½¿ç”¨ OpenAI Realtime API (gpt-4o-mini-realtime)
- âŒ å³æ™‚ä¸²æµéŸ³è¨Šä¸¦å³æ™‚è½‰éŒ„
- âŒ è¤‡é›œçš„ WebSocket é€£ç·šç®¡ç†
- âŒ éœ€è¦ chunking å’Œ VAD è™•ç†

**æ–°æ–¹æ¡ˆï¼ˆå·²å¯¦ä½œï¼‰ï¼š**
- âœ… ä½¿ç”¨ OpenAI Whisper API (whisper-1)
- âœ… å…ˆéŒ„éŸ³å®Œæˆï¼Œå†ä¸€æ¬¡æ€§è½‰éŒ„
- âœ… ç°¡å–®çš„ HTTP API èª¿ç”¨
- âœ… æ¯æ¬¡éŒ„éŸ³ç”¢ç”Ÿç¨ç«‹çš„éŸ³æª”å’Œé€å­—ç¨¿

## ğŸ¯ æ–°åŠŸèƒ½ç‰¹é»

### 1. ä½¿ç”¨ mic_recorder_page.py çš„éŒ„éŸ³é…ç½®
- âœ… ç›¸åŒçš„éŸ³è¨Šè™•ç†é‚è¼¯ (`process_audio_frame()`)
- âœ… ç›¸åŒçš„æ¡æ¨£ç‡é…ç½®ï¼ˆ48kHzï¼‰
- âœ… ç›¸åŒçš„éŸ³é‡å¢ç›Šï¼ˆ2.0xï¼‰
- âœ… æ­£ç¢ºè™•ç† stereo â†’ mono è½‰æ›

### 2. éº¥å…‹é¢¨ç‹€æ…‹ç¢ºèª
- âœ… éŒ„éŸ³å‰æª¢æŸ¥ WebRTC é€£ç·šç‹€æ…‹
- âœ… å¿…é ˆçœ‹åˆ°ç¶ è‰²ã€Œéº¥å…‹é¢¨å·²é€£ç·šã€è¨Šæ¯æ‰èƒ½é–‹å§‹éŒ„éŸ³
- âœ… å¦‚æœéº¥å…‹é¢¨æœªå°±ç·’ï¼Œé»æ“Šã€Œé–‹å§‹éŒ„éŸ³ã€æœƒé¡¯ç¤ºéŒ¯èª¤æç¤º

### 3. æ¯æ¬¡éŒ„éŸ³ç¨ç«‹æ–‡æª”
- âœ… æ¯æ¬¡éŒ„éŸ³ç”¢ç”Ÿç¨ç«‹çš„ WAV æª”æ¡ˆ
- âœ… æ¯æ¬¡éŒ„éŸ³ç”¢ç”Ÿå°æ‡‰çš„é€å­—ç¨¿ TXT æª”æ¡ˆ
- âœ… æª”ååŒ…å«æ™‚é–“æˆ³ï¼Œä¾¿æ–¼è­˜åˆ¥

### 4. å®Œæ•´çš„è½‰éŒ„æµç¨‹
1. ç­‰å¾…éº¥å…‹é¢¨é€£ç·šï¼ˆç¶ è‰²è¨Šæ¯ï¼‰
2. é»æ“Šã€Œé–‹å§‹éŒ„éŸ³ã€â†’ é–‹å§‹éŒ„è£½ WAV æª”æ¡ˆ
3. èªªè©±...ï¼ˆé¡¯ç¤ºéŒ„éŸ³ç‹€æ…‹ï¼‰
4. é»æ“Šã€Œåœæ­¢éŒ„éŸ³ä¸¦è½‰éŒ„ã€â†’ åœæ­¢éŒ„éŸ³ï¼Œè‡ªå‹•é€ Whisper API
5. é¡¯ç¤ºè½‰éŒ„çµæœä¸¦ä¿å­˜ç‚º TXT æª”æ¡ˆ
6. å¯ä¸‹è¼‰é€å­—ç¨¿

## ğŸ“ æª”æ¡ˆå‘½åè¦å‰‡

### WAV éŸ³æª”
```
resource/recording-20251102-123456.wav
```

### é€å­—ç¨¿æ–‡æª”
```
resource/recording-20251102-123456-transcript.txt
```

### é€å­—ç¨¿å…§å®¹æ ¼å¼
```
èªéŸ³è½‰éŒ„çµæœ
æ™‚é–“ï¼š2025-11-02 12:34:56
éŸ³è¨Šæª”æ¡ˆï¼šrecording-20251102-123456.wav
æ¡æ¨£ç‡ï¼š48000 Hz
æ¨¡å‹ï¼šOpenAI Whisper (whisper-1)

============================================================

[è½‰éŒ„å…§å®¹]
é€™æ˜¯è½‰éŒ„çš„æ–‡å­—å…§å®¹...
```

## ğŸš€ ä½¿ç”¨æµç¨‹

### 1. è¨­å®š API Key

**æ–¹æ³• Aï¼šç’°å¢ƒè®Šæ•¸**
```bash
# åœ¨ .env æª”æ¡ˆä¸­è¨­å®š
OPENAI_API_KEY=sk-...
```

**æ–¹æ³• Bï¼šé é¢è¼¸å…¥**
- é¦–æ¬¡é€²å…¥é é¢æœƒæç¤ºè¼¸å…¥ API Key
- è¼¸å…¥å¾Œæœƒä¿å­˜åœ¨ session ä¸­

### 2. ç­‰å¾…éº¥å…‹é¢¨é€£ç·š

é é¢è¼‰å…¥å¾Œæœƒè‡ªå‹•å˜—è©¦é€£ç·šéº¥å…‹é¢¨ï¼š
- ğŸ”„ **é»ƒè‰²è¨Šæ¯**ï¼šæ­£åœ¨å»ºç«‹é€£ç·š
- âš ï¸ **æ©˜è‰²è¨Šæ¯**ï¼šéº¥å…‹é¢¨æœªé€£ç·šï¼ˆæª¢æŸ¥ç€è¦½å™¨æ¬Šé™ï¼‰
- âœ… **ç¶ è‰²è¨Šæ¯**ï¼šéº¥å…‹é¢¨å·²é€£ç·šï¼Œå¯ä»¥é–‹å§‹éŒ„éŸ³

**é‡è¦**ï¼šå¿…é ˆç­‰åˆ°ç¶ è‰²è¨Šæ¯å‡ºç¾æ‰èƒ½é–‹å§‹éŒ„éŸ³ï¼

### 3. é–‹å§‹éŒ„éŸ³

1. ç¢ºèªçœ‹åˆ°ç¶ è‰²çš„ã€Œâœ… éº¥å…‹é¢¨å·²å°±ç·’ã€è¨Šæ¯
2. é»æ“Šã€Œâ–¶ï¸ é–‹å§‹éŒ„éŸ³ã€æŒ‰éˆ•
3. é–‹å§‹èªªè©±

**éŒ„éŸ³ç‹€æ…‹é¡¯ç¤ºï¼š**
- ğŸ“ æª”æ¡ˆè·¯å¾‘
- â±ï¸ éŒ„è£½æ™‚é•·
- ğŸ”Š ç•¶å‰éŸ³é‡ï¼ˆRMSï¼‰
- ğŸšï¸ æ¡æ¨£ç‡
- ğŸ“ˆ éŸ³é‡å¢ç›Š

### 4. åœæ­¢éŒ„éŸ³ä¸¦è½‰éŒ„

1. èªªå®Œå¾Œï¼Œé»æ“Šã€Œâ¹ï¸ åœæ­¢éŒ„éŸ³ä¸¦è½‰éŒ„ã€
2. ç³»çµ±æœƒï¼š
   - åœæ­¢éŒ„éŸ³
   - é—œé–‰ WAV æª”æ¡ˆ
   - è‡ªå‹•é€ OpenAI Whisper API è½‰éŒ„
   - é¡¯ç¤ºã€ŒğŸ”„ æ­£åœ¨è½‰éŒ„ä¸­ï¼Œè«‹ç¨å€™...ã€
3. è½‰éŒ„å®Œæˆå¾Œé¡¯ç¤ºçµæœ

### 5. æŸ¥çœ‹å’Œä¸‹è¼‰çµæœ

- è½‰éŒ„çµæœæœƒé¡¯ç¤ºåœ¨ã€ŒğŸ“„ è½‰éŒ„çµæœã€å€åŸŸ
- é¡¯ç¤ºå­—æ•¸çµ±è¨ˆ
- é¡¯ç¤ºä¿å­˜è·¯å¾‘
- å¯é»æ“Šã€ŒğŸ“¥ ä¸‹è¼‰é€å­—ç¨¿ã€æŒ‰éˆ•ä¸‹è¼‰ TXT æª”æ¡ˆ

## âš™ï¸ é…ç½®åƒæ•¸

### éŸ³è¨Šé…ç½®
```python
SAMPLE_RATE = 48000  # æ¡æ¨£ç‡ï¼ˆHzï¼‰
SAMPLE_WIDTH = 2     # ä½å…ƒæ·±åº¦ï¼ˆbytesï¼Œint16ï¼‰
AUDIO_GAIN = 2.0     # éŸ³é‡å¢ç›Šï¼ˆ2.0 = é›™å€ï¼‰
```

### Whisper API é…ç½®
```python
model="whisper-1"           # OpenAI Whisper æ¨¡å‹
language="zh"               # ä¸­æ–‡
response_format="text"      # ç´”æ–‡å­—è¼¸å‡º
```

## ğŸ”§ èª¿æ•´éŸ³é‡å¢ç›Š

å¦‚éœ€èª¿æ•´éŸ³é‡ï¼Œä¿®æ”¹ `AUDIO_GAIN` å¸¸æ•¸ï¼š

```python
# src/ui/transcription_page.py (Line 31)
AUDIO_GAIN = 2.0  # æ”¹ç‚º 1.5, 2.5, 3.0 ç­‰
```

**å»ºè­°å€¼ï¼š**
- `1.0` = åŸå§‹éŸ³é‡
- `1.5` = è¼•å¾®å¢å¼·
- `2.0` = æ¨è–¦ï¼ˆé è¨­ï¼‰
- `3.0` = å¤§å¹…å¢å¼·

## ğŸ› å¸¸è¦‹å•é¡Œ

### Q1: é»æ“Šã€Œé–‹å§‹éŒ„éŸ³ã€å¾Œé¡¯ç¤ºéŒ¯èª¤

**å•é¡Œ**ï¼šé¡¯ç¤ºã€Œâš ï¸ è«‹å…ˆç­‰å¾…éº¥å…‹é¢¨é€£ç·šæˆåŠŸã€

**è§£æ±º**ï¼š
1. ç­‰å¾…éº¥å…‹é¢¨é€£ç·šï¼ˆç¶ è‰²è¨Šæ¯ï¼‰
2. ç¢ºèªç€è¦½å™¨å·²æˆæ¬Šéº¥å…‹é¢¨æ¬Šé™
3. ä½¿ç”¨ Chrome æˆ– Edgeï¼ˆä¸è¦ç”¨ Safariï¼‰
4. ç¢ºèªæ˜¯ HTTPS æˆ– localhost

### Q2: è½‰éŒ„çµæœæ˜¯ç©ºç™½æˆ–éŒ¯èª¤

**å•é¡Œ**ï¼šè½‰éŒ„å¤±æ•—æˆ–çµæœç‚ºç©º

**è§£æ±º**ï¼š
1. ç¢ºèªéŒ„éŸ³æ™‚é•· > 1 ç§’
2. ç¢ºèªæœ‰èªªè©±ï¼ˆæª¢æŸ¥ RMS å€¼ > 0ï¼‰
3. ç¢ºèª OpenAI API Key æ­£ç¢ºä¸”æœ‰é¤˜é¡
4. æª¢æŸ¥ç¶²è·¯é€£ç·š

### Q3: éŸ³æª”æ’­æ”¾é€Ÿåº¦ç•°å¸¸

**å•é¡Œ**ï¼šéŒ„éŸ³æ’­æ”¾å¤ªå¿«æˆ–å¤ªæ…¢

**è§£æ±º**ï¼š
- é€™å€‹å•é¡Œå·²ä¿®å¾©ï¼
- æ–°ç‰ˆæœ¬æ­£ç¢ºè™•ç† interleaved stereo
- å¦‚æœé‚„æœ‰å•é¡Œï¼Œè«‹é‡æ–°å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼

### Q4: éŸ³é‡å¤ªå°

**å•é¡Œ**ï¼šéŒ„éŸ³éŸ³é‡å¤ªå°

**è§£æ±º**ï¼š
1. æé«˜ `AUDIO_GAIN` åˆ° 2.5 æˆ– 3.0
2. é è¿‘éº¥å…‹é¢¨èªªè©±
3. æª¢æŸ¥ç³»çµ±éº¥å…‹é¢¨éŸ³é‡è¨­å®š

## ğŸ“Š èˆ‡ mic_recorder_page çš„å·®ç•°

| åŠŸèƒ½ | mic_recorder_page | transcription_page |
|------|-------------------|-------------------|
| **ç”¨é€”** | æ¸¬è©¦éŒ„éŸ³åŠŸèƒ½ | èªéŸ³è½‰éŒ„ |
| **éŒ„éŸ³é‚è¼¯** | âœ… ç›¸åŒ | âœ… ç›¸åŒ |
| **éŸ³è¨Šè™•ç†** | âœ… ç›¸åŒ | âœ… ç›¸åŒ |
| **è½‰éŒ„åŠŸèƒ½** | âŒ ç„¡ | âœ… Whisper API |
| **è‡ªå‹•ä¿å­˜** | âœ… WAV only | âœ… WAV + TXT |
| **ç¨ç«‹æ–‡æª”** | âŒ å¦ | âœ… æ˜¯ |
| **éº¥å…‹é¢¨ç¢ºèª** | âš ï¸ æ‰‹å‹• | âœ… è‡ªå‹• |

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
```bash
./start.sh
```

### 2. æ¸¬è©¦éº¥å…‹é¢¨é€£ç·š
- é–‹å•ŸèªéŸ³è½‰éŒ„é é¢
- ç­‰å¾…ç¶ è‰²ã€Œéº¥å…‹é¢¨å·²é€£ç·šã€è¨Šæ¯
- è§€å¯Ÿ RMS å€¼æ˜¯å¦éš¨è‘—èªªè©±è®ŠåŒ–

### 3. æ¸¬è©¦éŒ„éŸ³
- é»æ“Šã€Œé–‹å§‹éŒ„éŸ³ã€
- èªªè©± 5-10 ç§’
- è§€å¯ŸéŒ„éŸ³ç‹€æ…‹ï¼ˆæ™‚é•·ã€RMSï¼‰

### 4. æ¸¬è©¦è½‰éŒ„
- é»æ“Šã€Œåœæ­¢éŒ„éŸ³ä¸¦è½‰éŒ„ã€
- ç­‰å¾…è½‰éŒ„å®Œæˆ
- æª¢æŸ¥è½‰éŒ„çµæœæ˜¯å¦æ­£ç¢º

### 5. æª¢æŸ¥æª”æ¡ˆ
```bash
# æŸ¥çœ‹ç”Ÿæˆçš„æª”æ¡ˆ
ls -lh resource/recording-*.wav
ls -lh resource/recording-*-transcript.txt

# æŸ¥çœ‹é€å­—ç¨¿å…§å®¹
cat resource/recording-*-transcript.txt
```

## ğŸ“ æŠ€è¡“ç´°ç¯€

### éŸ³è¨Šè™•ç†æµç¨‹
```
WebRTC Microphone
    â†“
process_audio_frame(frame, gain=2.0)
    â†“ (stereo â†’ mono, correct sample count)
Audio Queue
    â†“
Worker Thread
    â†“
WAV File (48kHz, mono, int16)
```

### è½‰éŒ„æµç¨‹
```
Stop Recording
    â†“
Close WAV File
    â†“
Check File Size (> 44 bytes)
    â†“
OpenAI Whisper API
    â†“
Save Transcript (.txt)
    â†“
Display Result
```

### æª”æ¡ˆå¤§å°ä¼°ç®—
```
48kHz Ã— 2 bytes Ã— duration (seconds) + 44 bytes (header)

1 ç§’éŒ„éŸ³ â‰ˆ 96 KB
5 ç§’éŒ„éŸ³ â‰ˆ 480 KB
10 ç§’éŒ„éŸ³ â‰ˆ 960 KB
60 ç§’éŒ„éŸ³ â‰ˆ 5.8 MB
```

## âœ… æª¢æŸ¥æ¸…å–®

- [x] ç§»é™¤ Realtime API ç›¸é—œä»£ç¢¼
- [x] ä½¿ç”¨ mic_recorder_page çš„éŒ„éŸ³é…ç½®
- [x] å¯¦ä½œéº¥å…‹é¢¨ç‹€æ…‹ç¢ºèª
- [x] å¯¦ä½œæ¯æ¬¡éŒ„éŸ³ç¨ç«‹æ–‡æª”
- [x] æ•´åˆ OpenAI Whisper API
- [x] è‡ªå‹•ä¿å­˜é€å­—ç¨¿ç‚º TXT
- [x] æä¾›ä¸‹è¼‰åŠŸèƒ½
- [x] éŸ³è¨Šè™•ç†æ­£ç¢ºï¼ˆä¸æœƒæ…¢ä¸€å€ï¼‰
- [x] éŸ³é‡å¢ç›ŠåŠŸèƒ½

---

**é‡æ§‹å®Œæˆæ—¥æœŸ**ï¼š2025-11-02
**æ¸¬è©¦ç‹€æ…‹**ï¼šå¾…æ¸¬è©¦
