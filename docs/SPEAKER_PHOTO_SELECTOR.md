# 講者圖片選擇功能說明

## 功能概述

管理員在新增或編輯議程時,可以使用兩種方式來設定講者照片:

1. **從現有圖片選擇** - 從 `resource/speaker-photo/` 目錄中選擇已上傳的照片
2. **上傳新圖片** - 直接上傳新的講者照片

## 使用方式

### 新增議程時

1. 進入管理員面板 (需要登入)
2. 點擊 "➕ 新增議程"
3. 填寫議程基本資訊
4. 在 "📸 講者照片" 區塊:
   - 選擇 "從現有圖片選擇" 或 "上傳新圖片"
   
   **選項 A: 從現有圖片選擇**
   - 使用下拉選單選擇照片
   - 系統會顯示預覽圖
   - 顯示已選擇的檔案名稱
   
   **選項 B: 上傳新圖片**
   - 點擊 "Browse files" 或拖曳檔案
   - 支援格式: PNG、JPG、JPEG、GIF
   - 建議檔案大小 < 10MB
   - 上傳後會顯示預覽

### 編輯議程時

1. 在管理員面板中點擊議程的 "✏️" 編輯按鈕
2. 系統會顯示目前的講者照片路徑
3. 在 "📸 講者照片" 區塊:
   - 選擇 "從現有圖片選擇" - 切換到其他已存在的照片
   - 選擇 "上傳新圖片" - 上傳新照片替換舊的
   - 如果不做任何選擇,將保持原有照片

## 照片管理

### 現有照片列表

系統會自動掃描 `resource/speaker-photo/` 目錄,按修改時間排序 (最新的在前):

- ken2_hung_1762230105.jpg (7.8 KB)
- ken2_hung_1762229887.jpg (7.8 KB)
- ttt_1761704117.png (2.5 MB)
- test_1761703366.png (2.5 MB)
- ken_1761701540.png (2.5 MB)

### 上傳新照片

當上傳新照片時:
- 檔案會自動命名為: `{講者姓名}_{時間戳記}.{副檔名}`
- 例如: `ken2_hung_1762230105.jpg`
- 儲存在 `resource/speaker-photo/` 目錄

### 支援格式

- ✅ PNG (.png)
- ✅ JPG/JPEG (.jpg, .jpeg)
- ✅ GIF (.gif)
- ❌ 不支援其他格式

## 顯示效果

### 議程詳情頁面

講者照片會以以下方式顯示:
- 圓形頭像 (120px × 120px)
- 粉紅色漸層邊框
- 柔和陰影效果
- 置中對齊,位於講者資訊區塊

### 降級處理

如果照片無法載入:
- 顯示講者姓名縮寫的圓形佔位符
- 使用漸層色背景
- 保持相同的視覺樣式

## 技術實作

### Base64 轉換

本地檔案會自動轉換為 base64 data URI,解決 Streamlit 無法直接顯示本地圖片的限制:

```python
data:image/png;base64,iVBORw0KGgoAAAANSUhEUg...
```

### 路徑處理

支援多種路徑格式:
- 相對路徑: `resource/speaker-photo/photo.jpg`
- HTTP/HTTPS: `https://example.com/photo.jpg`
- Data URI: `data:image/png;base64,...`

### 檔案鎖定

更新議程時使用檔案鎖定機制,避免並發衝突:
- Windows: 使用獨立的 `.lock` 檔案
- Unix/Linux: 使用 `fcntl.flock()`
- 自動重試機制處理暫時性錯誤

## 最佳實踐

1. **檔案命名**: 使用有意義的檔案名稱,方便識別
2. **檔案大小**: 建議壓縮大圖片至 < 1MB
3. **重複使用**: 同一位講者可重複使用同一張照片
4. **定期清理**: 定期清理不再使用的舊照片

## 常見問題

**Q: 為什麼我看不到上傳的照片?**
A: 確認照片格式是否支援 (PNG/JPG/GIF),並檢查檔案是否過大。

**Q: 可以刪除舊照片嗎?**
A: 可以直接從 `resource/speaker-photo/` 目錄中刪除檔案。

**Q: 照片會自動壓縮嗎?**
A: 目前不會,建議上傳前先手動壓縮大檔案。

**Q: 編輯時如何保持原照片不變?**
A: 在編輯表單中選擇 "從現有圖片選擇",然後選擇目前的照片路徑。

## 相關檔案

- 照片選擇器: `src/ui/admin_panel.py` - `_render_speaker_photo_selector()`
- 圖片顯示: `src/ui/session_detail.py` - `_detail_speaker_html()`
- Base64 轉換: `src/ui/session_detail.py` - `_get_image_base64()`
- 照片目錄: `resource/speaker-photo/`
